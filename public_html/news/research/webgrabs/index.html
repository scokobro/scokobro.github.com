<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>Capturing the content of news websites</title> <link rel="stylesheet" href="http://www.ritsumei.ac.jp/~spkb/assets/css/styles_feeling_responsive.css"> <script src="http://www.ritsumei.ac.jp/~spkb/assets/js/modernizr.min.js"></script> <script> WebFontConfig = { google: { families: [ 'Rubik:300,700:latin','Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }; (function() { var wf = document.createElement('script'); wf.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js'; wf.type = 'text/javascript'; wf.async = 'true'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wf, s); })(); </script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ" /> <meta name="msvalidate.01" content="0FB4C028ABCF07C908C54386ABD2D97F" /> <meta name="description" content="One of the big problems a researcher faces when dealing with &#39;the internet&#39; is how to capture and keep a record, this is a recent attempt to develop a practical technique..."/> <link rel="author" href="https://plus.google.com/u/0/118311555303973066167"/> <link rel="icon" sizes="32x32" href="http://www.ritsumei.ac.jp/~spkb/assets/img/favicon-32x32.png"> <link rel="icon" sizes="192x192" href="http://www.ritsumei.ac.jp/~spkb/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="http://www.ritsumei.ac.jp/~spkb/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="http://www.ritsumei.ac.jp/~spkb/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="Capturing the content of news websites" /> <meta property="og:description" content="» Masu-komi Review « is the departmental website of a British academic working at Ritsumeikan University in Kyoto, its content is primarily aimed at registered students, but it&#39;s there for anyone interested."/> <meta property="og:url" content="http://www.ritsumei.ac.jp/~spkb/news/research/webgrabs/" /> <meta property="og:site_name" content="Media Research from Japan" /> <meta property="og:image" content="http://www.ritsumei.ac.jp/~spkb/images/GRABthumb.png" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="http://www.ritsumei.ac.jp/~spkb/humans.txt" /> </head> <body id="top-of-page" class=""> <div id="navigation" class="sticky"> <nav class="top-bar" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="http://www.ritsumei.ac.jp/~spkb" class="icon-tree"> Media Research from Japan</a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/search/">Search</a></li> <li class="divider"></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/contact/">Contact</a></li> </ul> <ul class="left"> <li><a href="http://www.ritsumei.ac.jp/~spkb/">Home</a></li> <li class="divider"></li> <li class="has-dropdown"> <a href="http://www.ritsumei.ac.jp/~spkb/research/">Research</a> <ul class="dropdown"> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/camangles/">Camera Angles in News</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/soc-dist/">Social Distance Portrayed</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/dtv/">Digital TV in Japan</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/phd/">Visual Semiosis (PhD Thesis)</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/oshigami/">Newspaper Sales in Japan</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/research/">All articles</a></li> </ul> </li> <li class="divider"></li> <li class="has-dropdown"> <a href="http://www.ritsumei.ac.jp/~spkb/classes/">Classes</a> <ul class="dropdown"> <li><a href="http://www.ritsumei.ac.jp/~spkb/classes/miwp/">MIWP</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/classes/xcc/">XCC</a></li> </ul> </li> <li class="divider"></li> <li class="has-dropdown"> <a href="http://www.ritsumei.ac.jp/~spkb/blog/">Blog</a> <ul class="dropdown"> <li><a href="http://www.ritsumei.ac.jp/~spkb/blog/">Recent articles</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/blog/archive/">Archive</a></li> </ul> </li> <li class="divider"></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/photos/">Photos</a></li> <li class="divider"></li> </ul> </section> </nav> </div><!-- /#navigation --> <div id="masthead-no-image-header"> <div class="row"> <div class="small-12 columns"> <a id="logo" href="http://www.ritsumei.ac.jp/~spkb" title="Media Research from Japan – Research on the mass media from Japan"> <img src="http://www.ritsumei.ac.jp/~spkb/assets/img/logo.png" alt="Media Research from Japan – Research on the mass media from Japan"> </a> </div><!-- /.small-12.columns --> </div><!-- /.row --> </div><!-- /#masthead --> <nav class="breadcrumbs" role="menubar" aria-label="breadcrumbs"> <li><a href="http://www.ritsumei.ac.jp/~spkb">Start</a></li> <li><a href="http://www.ritsumei.ac.jp/~spkb/news/">news</a> <li><a href="http://www.ritsumei.ac.jp/~spkb/news/research/">research</a> <li class="current">Capturing the content of news websites</li> </nav> <!-- added auto date after title, UNLESS 'dateoff=true' is set in meta--> <div class="row t30"> <div class="medium-8 columns medium-offset-2 end"> <article itemscope itemtype="http://schema.org/Article"> <header> <figure> <img src="http://www.ritsumei.ac.jp/~spkb/images/GRABnyt-montage.png" width="970" alt="Capturing the content of news websites" itemprop="image"> <figcaption class="text-right"> Automated, scheduled capture of news website content. </figcaption> </figure> <span itemprop="name"> <p class="subheadline"> Developing techniques to capture news websites programmatically.</p> <h1>Capturing the content of news websites</h1> <span style="color:#bbb">PUBLISHED: 24 Apr 2017</span> </span> </header> <p class="teaser" itemprop="description"> One of the big problems a researcher faces when dealing with 'the internet' is how to capture and keep a record, this is a recent attempt to develop a practical technique... </p> <span itemprop="articleSection"> <h1 id="project-news-on-websites">Project: News on websites</h1> <p>I decided I wanted to try to do a piece of research which looked at how different organisations, online newspapers, approached updating their website content.</p> <p>My starting point was a set of related questions, along these lines: How do leading newspaper websites present ‘the news’ to their readers? How do strategies for news presentation vary? What are the differences between ‘western’ media and the media in Japan?</p> <p>I was also interested in developing practical ways to record the content of news websites, this is not as easy as it might seem.</p> <h2 id="choosing-websites">Choosing websites</h2> <p>My choice was influenced by two separate factors.</p> <dl> <dt>A. The ‘capturability’ of the site</dt> <dd><p>Not all newspaper websites are constructed in the same way, and indeed a good many of them are exceedingly complex as they draw in and present a great variety of content, which often includes various forms (video, gifs, images) of advertising supplied by an outside party such as Google.</p> </dd> </dl> <p>As a result, websites can look very different when you try to capture them. I chose websites which, when converted via the capture process into a still representation, turned out pretty much like the ‘live’ website.</p> <dl> <dt>B. Quality of content</dt> <dd><p>I decided to go with newspapers that can reasonable be thought of as representing ‘quality’ journalism in their respective markets. These are (I’m fairly certain) not the most popular sources for news, but they all have an important and respected position in the journalistic tradition, and the ‘national conversation’, of their respective countries.</p> </dd> </dl> <p>The (entirely unsurprising) resulting choices were -</p> <ul> <li>USA: <a href="http://www.nytimes.com">New York Times</a></li> <li>UK: <a href="http://www.theguardian.com">the Guardian</a></li> <li>Japan: <a href="http://www.asahi.com">Asahi Shimbun</a></li> </ul> <p>As you will see, these choices are also useful in another more subtle way, more about that in ‘<a href="#scheduling-captures">Scheduling Captures</a>’ below.</p> <h2 id="practicalities">Practicalities</h2> <p>I normally work on a Mac so most of the stuff I explain here - while it should be adaptable to a Windows environment - assumes a Unix-y style environment, having said that this project is currently reliant on a piece of Windows software (ZCron).</p> <p>The initial problem was how to capture the whole of a news website accurately and programmatically. The capture process has to be automated so after various attempts to use browser plugins (e.g. Chrome’s ‘Awesome Screenshot’ etc) with some sort of keystroke/UI automation (using the very wonderful <a href="hammerspoon.org/">Hammerspoon</a>) I eventually stumbled up what seems to be a great tool for doing exactly what I want…</p> <!-- Tried browser plugins (paparrazzi, various coded kluges) --> <h3 id="phantom.js">Phantom.js</h3> <p>I started off by pinching another (more programming-talented) user’s script as I couldn’t work out how to capture more than one site and get accurate and reliable capture times in my filenames, a/synchronous stuff and javascript, yeuch…</p> <p>I ended up adding a little subroutine to name and date files in a more useful way.</p> <p>Here’s the script I am using, it’s adapted slightly (with a great deal of thanks to the author!) from the original <code>render_multi_urls.js</code> on the <a href="https://github.com/ariya/phantomjs/blob/master/examples/render_multi_url.js">Phantom.js examples github repository</a>.</p> <div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Render Multiple URLs to file</span>

<span class="st">&quot;use strict&quot;</span><span class="op">;</span>
<span class="kw">var</span> RenderUrlsToFile<span class="op">,</span> arrayOfUrls<span class="op">,</span> system<span class="op">;</span>

system <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;system&quot;</span>)<span class="op">;</span>

<span class="co">/*</span>
<span class="co">Render given urls</span>
<span class="co">@param array of URLs to render</span>
<span class="co">@param callbackPerUrl Function called after finishing each URL, including the last URL</span>
<span class="co">@param callbackFinal Function called after finishing everything</span>
<span class="co">*/</span>

RenderUrlsToFile <span class="op">=</span> <span class="kw">function</span>(urls<span class="op">,</span> callbackPerUrl<span class="op">,</span> callbackFinal) <span class="op">{</span>
    <span class="kw">var</span> getFilename<span class="op">,</span> next<span class="op">,</span> page<span class="op">,</span> retrieve<span class="op">,</span> urlIndex<span class="op">,</span> webpage<span class="op">,</span> t<span class="op">;</span>
    urlIndex <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>
    webpage <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;webpage&quot;</span>)<span class="op">;</span>
    page <span class="op">=</span> <span class="kw">null</span><span class="op">;</span>
    t <span class="op">=</span> <span class="at">timestamp</span>()<span class="op">;</span><span class="co">//added by spkb &lt;!--1413_24–01--&gt;</span>
    getFilename <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span>
        <span class="cf">return</span> <span class="st">&quot;RM=&quot;</span> <span class="op">+</span> t <span class="op">+</span> <span class="st">&quot;__&quot;</span> <span class="op">+</span> urlIndex <span class="op">+</span> <span class="st">&quot;.png&quot;</span><span class="op">;</span>
    <span class="op">};</span>
    next <span class="op">=</span> <span class="kw">function</span>(status<span class="op">,</span> url<span class="op">,</span> file) <span class="op">{</span>
        <span class="va">page</span>.<span class="at">close</span>()<span class="op">;</span>
        <span class="at">callbackPerUrl</span>(status<span class="op">,</span> url<span class="op">,</span> file)<span class="op">;</span>
        <span class="cf">return</span> <span class="at">retrieve</span>()<span class="op">;</span>
    <span class="op">};</span>
    retrieve <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span>
        <span class="kw">var</span> url<span class="op">;</span>
        <span class="cf">if</span> (<span class="va">urls</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span>
            url <span class="op">=</span> <span class="va">urls</span>.<span class="at">shift</span>()<span class="op">;</span>
            urlIndex<span class="op">++;</span>
            page <span class="op">=</span> <span class="va">webpage</span>.<span class="at">create</span>()<span class="op">;</span>
            <span class="va">page</span>.<span class="at">viewportSize</span> <span class="op">=</span> <span class="op">{</span> <span class="dt">width</span><span class="op">:</span> <span class="dv">1024</span><span class="op">,</span> <span class="dt">height</span><span class="op">:</span> <span class="dv">768</span> <span class="op">};</span>
            <span class="va">page</span>.<span class="va">settings</span>.<span class="at">userAgent</span> <span class="op">=</span> <span class="st">&quot;Phantom.js bot&quot;</span><span class="op">;</span>
            <span class="cf">return</span> <span class="va">page</span>.<span class="at">open</span>(<span class="st">&quot;http://&quot;</span> <span class="op">+</span> url<span class="op">,</span> <span class="kw">function</span>(status) <span class="op">{</span>
                <span class="kw">var</span> file<span class="op">;</span>
                file <span class="op">=</span> <span class="at">getFilename</span>()<span class="op">;</span>
                <span class="cf">if</span> (status <span class="op">===</span> <span class="st">&quot;success&quot;</span>) <span class="op">{</span>
                    <span class="cf">return</span> <span class="va">window</span>.<span class="at">setTimeout</span>((<span class="kw">function</span>() <span class="op">{</span>
                        <span class="va">page</span>.<span class="at">render</span>(file)<span class="op">;</span>
                        <span class="cf">return</span> <span class="at">next</span>(status<span class="op">,</span> url<span class="op">,</span> file)<span class="op">;</span>
                    <span class="op">}</span>)<span class="op">,</span> <span class="dv">200</span>)<span class="op">;</span>
                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
                    <span class="cf">return</span> <span class="at">next</span>(status<span class="op">,</span> url<span class="op">,</span> file)<span class="op">;</span>
                <span class="op">}</span>
            <span class="op">}</span>)<span class="op">;</span>
        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
            <span class="cf">return</span> <span class="at">callbackFinal</span>()<span class="op">;</span>
        <span class="op">}</span>
    <span class="op">};</span>
    <span class="cf">return</span> <span class="at">retrieve</span>()<span class="op">;</span>
<span class="op">};</span>

arrayOfUrls <span class="op">=</span> <span class="kw">null</span><span class="op">;</span>

<span class="cf">if</span> (<span class="va">system</span>.<span class="va">args</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) <span class="op">{</span>
    arrayOfUrls <span class="op">=</span> <span class="va">Array</span>.<span class="va">prototype</span>.<span class="va">slice</span>.<span class="at">call</span>(<span class="va">system</span>.<span class="at">args</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span>
<span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Usage: phantomjs render_multi_url.js [domain.name1, domain.name2, ...]&quot;</span>)<span class="op">;</span>
    arrayOfUrls <span class="op">=</span> [
        <span class="st">&#39;www.asahi.com/&#39;</span><span class="op">,</span>
        <span class="st">&#39;www.nytimes.com/&#39;</span><span class="op">,</span>
        <span class="st">&#39;www.theguardian.com/uk/&#39;</span>]<span class="op">;</span>
<span class="op">}</span>

<span class="at">RenderUrlsToFile</span>(arrayOfUrls<span class="op">,</span> (<span class="kw">function</span>(status<span class="op">,</span> url<span class="op">,</span> file) <span class="op">{</span>
    <span class="cf">if</span> (status <span class="op">!==</span> <span class="st">&quot;success&quot;</span>) <span class="op">{</span>
        <span class="cf">return</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Unable to render &#39;&quot;</span> <span class="op">+</span> url <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span>)<span class="op">;</span>
    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
        <span class="cf">return</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;Rendered &#39;&quot;</span> <span class="op">+</span> url <span class="op">+</span> <span class="st">&quot;&#39; at &#39;&quot;</span> <span class="op">+</span> file <span class="op">+</span> <span class="st">&quot;&#39;&quot;</span>)<span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span>)<span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span>
    <span class="cf">return</span> <span class="va">phantom</span>.<span class="at">exit</span>()<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>

<span class="co">// added to assist with naming generated files //</span>
<span class="kw">function</span> <span class="at">timestamp</span>()<span class="op">{</span>
    <span class="kw">var</span> currentTime <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>()
    <span class="kw">var</span> dat <span class="op">=</span> <span class="va">currentTime</span>.<span class="at">getDate</span>()
    dat <span class="op">=</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> dat).<span class="at">substr</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span>
    <span class="kw">var</span> mth <span class="op">=</span> <span class="va">currentTime</span>.<span class="at">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>
    mth <span class="op">=</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> mth).<span class="at">substr</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span>
    <span class="kw">var</span> hours <span class="op">=</span> <span class="va">currentTime</span>.<span class="at">getHours</span>()
    hours <span class="op">=</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> hours).<span class="at">substr</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span>
    <span class="kw">var</span> minutes <span class="op">=</span> <span class="va">currentTime</span>.<span class="at">getMinutes</span>()
    minutes <span class="op">=</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> minutes).<span class="at">substr</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span>
    <span class="kw">var</span> seconds <span class="op">=</span> <span class="va">currentTime</span>.<span class="at">getSeconds</span>()
    seconds <span class="op">=</span> (<span class="st">&quot;00&quot;</span> <span class="op">+</span> seconds).<span class="at">substr</span>(<span class="op">-</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span>)<span class="op">;</span>
    <span class="cf">return</span> dat<span class="op">+</span><span class="st">&quot;-&quot;</span><span class="op">+</span>mth<span class="op">+</span><span class="st">&quot;=&quot;</span><span class="op">+</span>hours<span class="op">+</span><span class="st">&quot;-&quot;</span><span class="op">+</span>minutes<span class="op">+</span><span class="st">&quot;-&quot;</span><span class="op">+</span>seconds<span class="op">;</span>
<span class="op">}</span></code></pre></div> <p>In retrospect it might have been more sensible to keep the capturing of the sites in separate scripts, this would have made it easier (at least in some ways) to deal with the next issue; how to schedule and execute the running of the capture script(s).</p> <p>Captured images are 1024 pixels wide and generally 6000-8000 pixels tall. As I will explain later on, the difference in height affects how straightforward it is to do programmatic comparison of content. This factor and the fact that the bottom chunk of this type of webpage can go virtually unchanged for days, if not weeks, is leading me to think that it might be a good idea to crop all the images to a common size, say 1024 x 4000 or so.</p> <h2 id="scheduling-captures">Scheduling captures</h2> <p>The capture schedule is a series of ‘rolling weeks’, and for each selected day each website is captured every 20 minutes during the ‘daytime’, when most staff are around to keep the website fresh. A ‘rolling week’ is a way of getting an overview of news content without having it influenced by one particular story or issue (big stories can dominate content for a certain amount of time), or by the producers’ scheduling of certain types of content - maybe a certain website has a lot of sports coverage on Mondays for example.</p> <p>For example:</p> <table> <caption>Letter ‘x’ indicates days when captures are scheduled to happen.</caption> <thead> <tr class="header"> <th>Week No.</th> <th align="center">M</th> <th align="center">T</th> <th align="center">W</th> <th align="center">T</th> <th align="center">F</th> <th align="center">S</th> <th align="center">S</th> </tr> </thead> <tbody> <tr class="odd"> <td>1</td> <td align="center">x</td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> </tr> <tr class="even"> <td>2</td> <td align="center"></td> <td align="center">x</td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> </tr> <tr class="odd"> <td>3</td> <td align="center"></td> <td align="center"></td> <td align="center">x</td> <td align="center"></td> <td align="center"></td> <td align="center"></td> <td align="center"></td> </tr> </tbody> </table> <p>You get the picture…</p> <h3 id="defining-a-news-day">Defining a ‘news day’</h3> <p>Then, for each selected day I start capturing the websites at 0800JST and run through until 1000JST the next morning, the reason for this being; we start by defining what time we are going to think of as ‘daytime’, in this case I decided it is ‘8am to 8pm’, this is pretty arbitrary so feel free to argue. Then in order to capture the ‘daytime’ activity in Japan, the UK and the US, these ties have to be translated into Japan Standard Time JST as I’m working in Japan.</p> <table> <thead> <tr class="header"> <th>Location</th> <th>JST</th> <th>Daytime Local Time</th> <th>Time Diff</th> </tr> </thead> <tbody> <tr class="odd"> <td>Japan</td> <td>0800-2000</td> <td>0800-2000 JST</td> <td>nil</td> </tr> <tr class="even"> <td>UK</td> <td>1700-0500</td> <td>0800-2000 GMT/BST</td> <td>JST -9/8</td> </tr> <tr class="odd"> <td>USA</td> <td>2200-1000</td> <td>0800-2000 EST</td> <td>JST -14</td> </tr> </tbody> </table> <p>This means there are three overlapping periods within which I need to do the captures, so - as it turns out - one of my ‘news days’ is actually 26 hours long…</p><pre><code>&lt;--- JAPAN DAY (0800-2000 JST) ---&gt;
         &lt;--- UK DAY (1700-0500 JST) ---&gt;
              &lt;--- US DAY (2200-1000 JST) ---&gt;</code></pre><h3 id="how-often-to-capture">How often to capture?</h3> <p>My decision here was based on the practical consideration that I would only be able to process and manage a certain number of images; there is no technological reason why a capture shouldn’t have been done every 30 seconds or every minute, but this would have resulted in a final database of;<br /> </p><pre><code>2 captures per minute x 60 mins x 12 hrs x 3 sites x 10 newsdays
= waaaay too many! (43,200)</code></pre><p>Instead I took the attitude that while doing frequent captures might give a more fine-grained view of of how websites change, actually, most of the time they don’t change <em>that</em> much in a short period of time. So I decided – based on nothing more than what I felt to be common-sense – that a capture every 20 minutes would be sufficient to get a good idea of changes throughout a news day. This means a far more manageable final database and (I hope) doesn’t sacrifice too much in terms of getting a comprehensive and accurate view of changes on a site.</p><pre><code>3 captures per hour x 12 hrs x 3 sites x 10 newsdays
= 1080 (a nice round-ish manageable number)</code></pre><p>This gives a lot of images, pages and pages of this kind of thing…</p> <div class="figure"> <img src="http://www.ritsumei.ac.jp/~spkb/images/GRABnyt-montage.png" alt="NYT 1420-1720, 25 Jan 2017" /> <p class="caption">NYT 1420-1720, 25 Jan 2017</p> </div> <p>I estimate that the database will ultimately contain around 6GB of images.</p> <h3 id="advantages-and-drawbacks">Advantages and drawbacks</h3> <p>I would suggest that the strengths of an approach like this outweigh the drawbacks, they are;</p> <ul> <li>The headless browser means one can capture a version of a website which is not affected by any type of ‘personalisation’, based on a user’s browser history etc.</li> <li>Capturing can be done programmatically; reliably and in a regular way (not dependent on when the researcher is awake to do the capturing!)</li> </ul> <p>No methodology is without its weaknesses. These captures are a snapshot of a certain website, thus any <em>dynamic</em> content (crawlers, slideshows, video etc) is not reproduced accurately. Given that this type of content is becoming more common this might be a significant problem in the fairly near future, at the moment though I’m not sure it’s necessarily a deal-breaker.</p> <h2 id="processing-images">Processing Images</h2> <p>Once the content of the image database is created we move on to the next step of actually using the images to try to answer our questions.</p> <p>Before we do anything in the way of meaningful analysis though there are certain problems, well, wrinkles, which I have needed to deal with; specifically:</p> <ul> <li><p>The <em>Asahi Shimbun</em> site does not seem to define a background colour for its website (on the web the background probably looks ‘white’ but this is reliant on some browser default setting), and when captured in the ‘headless’ bot-type browser that <code>Phantom.js</code> creates, the captured words and pictures show up against a <em>transparent</em> background. This is not a big deal but it is rather distracting and makes the captures hard to view.</p></li> <li><p>The top of the Guardian webpage is an advertising banner, again probably because of the nature of the ‘browser’ used to do the capturing, the contents of the banner only show up intermittently.</p></li> <li><p>And (newsflash!) it seems that after 1 April 2017, the <em>New York Times</em> has instituted a ‘cookie confirm’ screen which (just for bot-type browsers?) effectively covers the entire page with a semi-transparent layer of white. The content is still legible but the effective contrast is greatly reduced; the black text looks pale grey, photo contrast/saturation is greatly reduced etc.</p></li> </ul> <p>So I think I need to do three things:</p> <ol style="list-style-type: decimal"> <li>Put all the <em>Asahi</em> captures against a white background.</li> <li>Chop off the top of all the <em>Guardian</em> captures; I’m not particularly interested in the content of the advertising and the banner is always the same size and this will make it easier to compare what I really want to look at, the news content.</li> <li>Knock the contrast on the <em>NYT</em> images up to a reasonable level, trying to make them as similar to the pre-April images.</li> </ol> <p>There are thus in the region of 1000 images that need to be processed in some way or other. One could do this by hand using Photoshop or some equivalent, but I think we all have better things to be doing with our time…</p> <p>And this is where the next handy tool comes in: <a href="http://imagemagick.org/script/index.php">ImageMagick</a></p> <p>ImageMagick(IM) is a command-line tool for image manipulation, it can do pretty much anything you might be able to do in Photoshop etc, but it can also do batch processing. Thus it can perform the same operation on, for example, all the files in a certain folder. This is an <em>extremely</em> handy thing to be able to do if you’re dealing with large numbers of images like I am here.</p> <h3 id="fixing-transparency">‘Fixing’ Transparency</h3> <p>This can be achieved with an IM command like …</p> <p><code>convert '*.png' -background white -alpha remove '*.png'</code></p> <p>which will take all PNG files in the folder the command is run from and replace transparency with ‘white’. Handling of filenames for output files is a bit basic and needs to be improved. It’s important that the files keep their correct names as the name contains the date and time they were created, and when managing your files it’s far easier to look at a file’s name than it is to dig through its more hidden ‘properties’.</p> <h3 id="getting-rid-of-that-banner">Getting rid of that banner</h3> <p>This will be done using the IM <code>chop</code> command, something like this …</p> <p><code>convert '*.png' -set filename:f 'trim-%f' -chop 0x125 '%[filename:f]'</code></p> <p>which will look for all PNGs in a folder, add the word ‘trim-’ to the beginning of the filename, chop off the top 125 pixels, and save the newly trimmed file (with its new name).</p> <h3 id="adjusting-contrastgamma">Adjusting contrast/gamma</h3> <p>Still to start working on getting this one right, but this…</p> <p><code>convert '*.png' -level 0%,100%,0.2 OUT.png</code></p> <p>seems to work ok. Unfortunately there’s no way to get rid of the massive banner that blocks out the top of part of the content.</p> <div class="figure"> <img src="http://www.ritsumei.ac.jp/~spkb/images/GRABNYTgamma.png" alt="Fixed! Sort of…" /> <p class="caption">Fixed! Sort of…</p> </div> <p>I may have to try to find another way to capture the NYT, or abandon the idea of using it as part of my sample.</p> <h2 id="comparing-images">Comparing images</h2> <p>It’s also possible to do a variety of <em>comparisons</em> of different sorts with ImageMagick.</p> <p>For instance: We can compare two sequential captures using IM’s ‘compare’ function; this looks at pixel-by-pixel differences in two images and produces output that highlights (in red) the differences it finds.</p> <div class="figure"> <img src="http://www.ritsumei.ac.jp/~spkb/images/GRABcompared.png" alt="Image 1 and 2 compared …" /> <p class="caption">Image 1 and 2 compared …</p> </div> <p>Unfortunately, the compare function doesn’t seem to always work as expected, and in fact using Photoshop CC to compare the same two images<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> can give different results. I suspect it may be useful as a guide to spotting where changes ‘may’ be taking place but that accurate and consistent analysis will have to be done by hand (and eye).</p> <h1 id="results-so-far">Results so far…</h1> <h2 id="analysis">Analysis</h2> <p>This is my initial plan:</p> <ol style="list-style-type: decimal"> <li>Consider all the websites in hourly blocks, that is in terms of changes over a single hour, or 3 consecutive capture images.</li> <li>Er… that’s it.</li> </ol> <p>Thinking about it, the unit of comparison shouldn’t really be ‘the pixel’, which is what the comparisons above were aiming at, it should be a unit which makes sense — i.e. actually has meaning for those who produce and consume the site — for news websites, that is, ‘the story’. And that makes the whole process a lot more reliant on my effort, which is a pity as I like to try to get my computer to do all the tedious repetitive tasks… ahh well.</p> <p>To be continued…</p> <div class="footnotes"> <hr /> <ol> <li id="fn1"><p>By putting the two images in layers and changing the layer composition between them to ‘difference’.<a href="#fnref1">↩</a></p></li> </ol> </div> </span> <div id="page-meta" class="t30"> <p> <!-- Look the author details up from the site config. --> <!-- Output author details if some exist. --> <time class="icon-calendar pr20" datetime="2017-04-24" itemprop="datePublished"> 2017-04-24</time> <span class="icon-archive pr20"> NEWS · RESEARCH</span> <br> <span class="pr20"><span class="icon-price-tag pr10"> blog</span> <span class="icon-price-tag pr10"> software</span> <span class="icon-price-tag pr10"> writing</span> <span class="icon-price-tag pr10"> images</span> <span class="icon-price-tag pr10"> webnews</span> </span> </p> <div id="post-nav" class="row"> <div class="small-5 columns"><a class="button small radius prev" href="http://www.ritsumei.ac.jp/~spkb/news/software/">&laquo; Software for students and academics</a></div><!-- /.small-4.columns --> <div class="small-2 columns text-center"><a class="radius button small" href="http://www.ritsumei.ac.jp/~spkb/blog/archive/" title="Blog Archive">Archive</a></div><!-- /.small-4.columns --> </div> </div><!-- /.page-meta --> </article> </div><!-- /.medium-8.columns --> </div><!-- /.row --> <div id="up-to-top" class="row"> <div class="small-12 columns" style="text-align: right;"> <a class="iconfont" href="#top-of-page">&#xf108;</a> </div><!-- /.small-12.columns --> </div><!-- /.row --> <footer id="footer-content" class="bg-grau"> <div id="footer"> <div class="row"> <div class="medium-6 large-5 columns"> <h5 class="shadow-black">About This Site</h5> <p class="shadow-black"> » Masu-komi Review « is the departmental website of a British academic working at Ritsumeikan University in Kyoto, its content is primarily aimed at registered students, but it's there for anyone interested. <a href="http://www.ritsumei.ac.jp/~spkb/info/">More ›</a> </p> </div><!-- /.large-6.columns --> <div class="small-6 medium-3 large-3 large-offset-1 columns"> <h5 class="shadow-black">Services</h5> <ul class="no-bullet shadow-black"> <li > <a href="http://www.ritsumei.ac.jp/~spkb" title=""></a> </li> <li class="services-contact" > <a href="http://www.ritsumei.ac.jp/~spkb/contact/" title="Contact">Contact</a> </li> <li class="rss-link" > <a href="http://www.ritsumei.ac.jp/~spkb/feed.xml" title="Subscribe to RSS">RSS</a> </li> <li class="sitemap-link" > <a href="http://www.ritsumei.ac.jp/~spkb/sitemap.xml" title="Sitemap for Google Webmastertools">sitemap.xml</a> </li> </ul> </div><!-- /.large-4.columns --> <div class="small-6 medium-3 large-3 columns"> <h5 class="shadow-black">Thanks</h5> <ul class="no-bullet shadow-black"> <li > <a href="http://www.ritsumei.ac.jp/~spkb" title=""></a> </li> <li class="network-entypo" > <a href="http://entypo.com/" target="_blank" title="Icons by Daniel Bruce">Icons by Daniel Bruce</a> </li> <li class="services-newsletter" > <a href="http://foundation.zurb.com/" target="_blank" title="Built on Foundation">Built on Foundation</a> </li> <li class="sitemap-link" > <a href="http://srobbin.com/jquery-plugins/backstretch/" target="_blank" title="Using Backstretch by Scott Robbin">Using Backstretch by Scott Robbin</a> </li> </ul> </div><!-- /.large-3.columns --> </div><!-- /.row --> </div><!-- /#footer --> <div id="subfooter"> <nav class="row"> <section id="subfooter-left" class="b30 small-12 medium-6 columns"> <ul class="inline-list"> <li>Created with &hearts; by <a style="display:inline;" href="http://phlow.de/">Phlow</a> with <a style="display:inline;" href="http://jekyllrb.com/" target="_blank">Jekyll</a> using <a style="display:inline;" href="http://phlow.github.io/feeling-responsive/">Feeling Responsive</a> </li> </ul> </section> <section id="subfooter-right" class="small-12 medium-6 columns social-icons"> <ul class="inline-list"> <li><a href="http://twitter.com/scokobro" target="_blank" class="icon-twitter" title="Why not?"></a></li> <li><a href="https://www.facebook.com/RitsIR" target="_blank" class="icon-facebook" title="Lass uns Freunde sein!"></a></li> <li><a href="http://github.com/scokobro" target="_blank" class="icon-github" title="Code and more..."></a></li> </ul> </section> </nav> </div><!-- /#subfooter --> </footer> <script src="http://www.ritsumei.ac.jp/~spkb/assets/js/javascript.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-60112281-1', 'auto'); ga('set', 'anonymizeIp', true); ga('send', 'pageview'); </script> </body> </html>
